# Disable directory browsing
Options -Indexes

<IfModule mod_rewrite.c>
  Options +FollowSymlinks
  RewriteEngine On

  # ----------------------------------------------------------------------
  # 1) Canonical: force HTTPS + non-www (single hop)
  # ----------------------------------------------------------------------

  # If request is http OR has www, redirect to https://non-www
  RewriteCond %{HTTPS} !=on [OR]
  RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
  RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

  # ----------------------------------------------------------------------
  # 2) Redirect Trailing Slashes (except real directories)
  # ----------------------------------------------------------------------
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} (.+)/$
  RewriteRule ^ %1 [L,R=301]

# ----------------------------------------------------------------------
# 3) SEO Redirect: old WordPress root URLs -> /articles/...
#    (Preserve path, avoid redirecting CI4 routes & assets)
# ----------------------------------------------------------------------

# Do not touch real files/folders (assets, images, etc.)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Do not redirect static folders (support /index.php/... form too)
RewriteCond %{REQUEST_URI} !^/(index\.php/)?(assets|css|js|images|uploads)(/|$) [NC]

# Do not redirect CI4 routes (support /index.php/... form too)
RewriteCond %{REQUEST_URI} !^/(index\.php/)?(solutions|services|company|resources|contact|contact-us|search|home)(/|$) [NC]

# Do not redirect anything already under /articles (prevent loop)
RewriteCond %{REQUEST_URI} !^/(index\.php/)?articles(/|$) [NC]

# Redirect everything else to /articles/<same-path>
RewriteRule ^(.+)$ /articles/$1 [R=301,L]


  # ----------------------------------------------------------------------
  # 4) CodeIgniter Front Controller
  # ----------------------------------------------------------------------

  # Pass through Authorization header
  RewriteCond %{HTTP:Authorization} .
  RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

  # Send non-existing requests to index.php
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^([\s\S]*)$ index.php/$1 [L,NC,QSA]
</IfModule>

<IfModule !mod_rewrite.c>
  ErrorDocument 404 index.php
</IfModule>

# Disable server signature
ServerSignature Off
